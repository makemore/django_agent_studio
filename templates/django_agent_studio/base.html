{% load static %}
<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <title>{% block title %}{{ studio_app_name }}{% endblock %}</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        // Brand Colors (from Django settings)
                        primary: {
                            "50": "#e6f7fc",
                            "100": "#cceff9",
                            "200": "#99dff3",
                            "300": "#66cfed",
                            "400": "{{ studio_colors.accent }}",
                            "500": "#33b5e7",
                            "600": "#2691b9",
                            "700": "#1a6d8b",
                            "800": "#0d495c",
                            "900": "{{ studio_colors.primary }}",
                            "950": "{{ studio_colors.primary_dark }}"
                        },
                        navy: {
                            "DEFAULT": "{{ studio_colors.primary }}",
                            "light": "{{ studio_colors.primary_light }}",
                            "dark": "{{ studio_colors.primary_dark }}"
                        },
                        cyan: {
                            "DEFAULT": "{{ studio_colors.accent }}",
                            "light": "{{ studio_colors.accent_light }}",
                            "dark": "{{ studio_colors.accent_dark }}"
                        },
                        slate: {
                            "DEFAULT": "{{ studio_colors.secondary }}",
                            "light": "{{ studio_colors.secondary_light }}",
                            "dark": "{{ studio_colors.secondary_dark }}"
                        }
                    },
                    fontFamily: {
                        sans: ['system-ui', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <!-- PrimeVue with custom theme overrides -->
    <link rel="stylesheet" href="https://unpkg.com/primevue@3/resources/themes/lara-light-blue/theme.css">
    <link rel="stylesheet" href="https://unpkg.com/primevue@3/resources/primevue.min.css">
    <link rel="stylesheet" href="https://unpkg.com/primeicons/primeicons.css">
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://unpkg.com/primevue@3/core/core.min.js"></script>
    <script src="https://unpkg.com/primevue@3/button/button.min.js"></script>
    <script src="https://unpkg.com/primevue@3/inputtext/inputtext.min.js"></script>
    <script src="https://unpkg.com/primevue@3/textarea/textarea.min.js"></script>
    <script src="https://unpkg.com/primevue@3/dropdown/dropdown.min.js"></script>
    <script src="https://unpkg.com/primevue@3/card/card.min.js"></script>
    <script src="https://unpkg.com/primevue@3/panel/panel.min.js"></script>
    <script src="https://unpkg.com/primevue@3/splitter/splitter.min.js"></script>
    <script src="https://unpkg.com/primevue@3/splitterpanel/splitterpanel.min.js"></script>
    <script src="https://unpkg.com/primevue@3/toast/toast.min.js"></script>
    <script src="https://unpkg.com/primevue@3/toastservice/toastservice.min.js"></script>
    <script src="https://unpkg.com/primevue@3/tabview/tabview.min.js"></script>
    <script src="https://unpkg.com/primevue@3/tabpanel/tabpanel.min.js"></script>
    
    <!-- Agent Frontend -->
    <link rel="stylesheet" href="{% static 'agent-frontend/chat-widget.css' %}">
    <script src="{% static 'agent-frontend/chat-widget.js' %}"></script>

    <!-- Enhanced Markdown Support -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/styles/github-dark.min.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
    <script src="{% static 'agent-frontend/chat-widget-markdown.js' %}"></script>
    
    <style>
        [v-cloak] { display: none; }
        
        /* ===== Brand Color Variables (from Django settings) ===== */
        :root {
            --studio-primary: {{ studio_colors.primary }};
            --studio-primary-light: {{ studio_colors.primary_light }};
            --studio-primary-dark: {{ studio_colors.primary_dark }};
            --studio-accent: {{ studio_colors.accent }};
            --studio-accent-light: {{ studio_colors.accent_light }};
            --studio-accent-dark: {{ studio_colors.accent_dark }};
            --studio-secondary: {{ studio_colors.secondary }};
            --studio-secondary-light: {{ studio_colors.secondary_light }};
            --studio-secondary-dark: {{ studio_colors.secondary_dark }};
        }
        
        /* Override PrimeVue primary color */
        .p-button {
            background: var(--studio-primary) !important;
            border-color: var(--studio-primary) !important;
        }
        .p-button:hover {
            background: var(--studio-secondary) !important;
            border-color: var(--studio-secondary) !important;
        }
        .p-button:focus {
            box-shadow: 0 0 0 2px #fff, 0 0 0 4px var(--studio-accent) !important;
        }
        .p-button.p-button-success {
            background: var(--studio-accent) !important;
            border-color: var(--studio-accent) !important;
            color: var(--studio-primary) !important;
        }
        .p-button.p-button-success:hover {
            background: var(--studio-accent-dark) !important;
            border-color: var(--studio-accent-dark) !important;
        }
        .p-button.p-button-text {
            background: transparent !important;
            color: var(--studio-primary) !important;
        }
        .p-button.p-button-text:hover {
            background: rgba(0, 20, 46, 0.08) !important;
        }
        
        /* Focus rings */
        .p-dropdown:focus,
        .p-inputtext:focus {
            border-color: var(--studio-accent) !important;
            box-shadow: 0 0 0 1px var(--studio-accent) !important;
        }
        
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f5f9;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }
        
        /* Override agent-frontend styles for embedded mode */
        .embedded-chat .cw-container {
            position: relative !important;
            width: 100% !important;
            height: 100% !important;
            max-height: none !important;
            border-radius: 0 !important;
            box-shadow: none !important;
        }
        .embedded-chat .cw-toggle-btn {
            display: none !important;
        }
        .embedded-chat .cw-widget {
            position: relative !important;
            width: 100% !important;
            height: 100% !important;
            max-height: none !important;
            border-radius: 0.5rem !important;
            display: flex !important;
            flex-direction: column !important;
            overflow: hidden !important;
        }
        .embedded-chat .cw-messages {
            flex: 1 !important;
            min-height: 0 !important;
            overflow-y: auto !important;
        }
        
        /* Logo styling */
        .studio-logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .studio-logo svg {
            height: 28px;
            width: auto;
        }
        
        /* Custom CSS from settings */
        {{ studio_custom_css|safe }}
    </style>
    
    {% block extra_head %}{% endblock %}
</head>
<body class="h-full bg-slate-50">
    <div id="app" v-cloak class="h-full flex flex-col">
        <!-- Header -->
        <header class="bg-navy text-white px-4 py-3 flex items-center justify-between shadow-lg">
            <div class="flex items-center space-x-6">
                <a href="{% url 'agent_studio:home' %}" class="studio-logo">
                    <!-- Logo from settings -->
                    {{ studio_logo_svg|safe }}
                    {% if studio_show_app_name %}
                    <div class="flex items-center">
                        <span class="text-lg font-semibold text-white/90">{{ studio_app_name }}</span>
                    </div>
                    {% endif %}
                </a>
                {% block breadcrumbs %}{% endblock %}
            </div>
            <div class="flex items-center space-x-4">
                {% if request.user.is_authenticated %}
                <span class="text-sm text-white/70">{{ request.user.email|default:request.user }}</span>
                <form method="post" action="{% url 'agent_studio:logout' %}" class="inline">
                    {% csrf_token %}
                    <button type="submit" class="text-sm text-white/60 hover:text-white transition-colors">Logout</button>
                </form>
                {% endif %}
            </div>
        </header>
        
        <!-- Main Content -->
        <main class="flex-1 overflow-hidden">
            {% block content %}{% endblock %}
        </main>
    </div>
    
    <!-- Toast container -->
    <p-toast></p-toast>
    
    {% block extra_js %}{% endblock %}
</body>
</html>
